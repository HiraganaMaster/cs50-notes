#include <stdio.h>
#include <cs50.h>
#include <math.h>

long get_card_number(void);
int input_length_validation(long input);
bool Luhn_validation(long input);

int main(void)
{
    long card_number = get_card_number();
    int length = input_length_validation(card_number);
    bool valid = Luhn_validation(card_number);
    if (length == 1 && valid)
    {
        printf("MASTERCARD\n");
    }
    else if (length == 2 && valid)
    {
        printf("VISA\n");
    }
    else if (length == 3 && valid)
    {
        printf("AMEX\n");
    }
    else 
    {
        printf("INVALID\n");
    }
    return 0;
}

long get_card_number(void)
{
    long l;
    do
    {
        l = get_long("Number: ");
    }
    while (l < 0);
    return l;
}

int input_length_validation(long input)
{
    long a = pow(10,14);
    long b = pow(10,13);
    long c = pow(10,12);
    // Mastercard 16, 51 - 55
    if (input / a > 50 && input / a < 56)
    {
        return 1;
    }
    // Visa 16 & 14, 40 - 49
    else if ((input / a >= 40 && input / a < 50) || (input / c >= 40 && input / c < 50))
    {
        return 2;
    }
    // Amex 15, 34 & 37
    else if (input / b == 34 || input / b == 37)
    {
        return 3;
    }
    else
    {
        return 0;
    }
}

bool Luhn_validation(long input) 
{
    long a = 0, b = 0, c = 0, d = 0;
    while (input > 0)
    {
        a += (input % 10);
        input /= 10;
        b = (input % 10);
        b = b * 2;
        c = b % 10;
        b = b / 10;
        d += b + c;
        input /= 10;
    }
    int e = a + d;
    if (e % 10 == 0)
    {
        return 1;
    }
    else
    {
        return 0;
    }
}
